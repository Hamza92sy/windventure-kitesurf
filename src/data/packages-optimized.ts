// üéØ PACKAGES WINDVENTURE - OPTIMIS√âS 4 PERSONNES
// Capacit√© h√©bergement : 4 personnes maximum
// Rentabilit√© valid√©e : 68-115k‚Ç¨/an b√©n√©fice net
// Int√©gration Stripe compl√®te

export interface Package {
  id: string;
  name: string;
  price: number; // Prix par personne
  maxPersons: number; // Capacit√© maximum
  duration: string;
  durationDays: number;
  shortDescription: string;
  fullDescription: string;
  included: string[];
  stripeProductId: string;
  stripePriceId: string;
  marginNet: number; // Marge nette √† capacit√© max
  isPopular?: boolean;
  isPremium?: boolean;
  category: 'private' | 'group' | 'premium';
  // Legacy compatibility
  description?: string;
  features?: string[];
  maxParticipants?: number;
  difficulty?: 'beginner' | 'intermediate' | 'advanced';
  image?: string;
}

export const packagesOptimized: Package[] = [
  // üü¢ PACKAGE PRIV√â (1 personne)
  {
    id: 'beginner-private',
    name: 'Beginner Private',
    price: 720,
    maxPersons: 1,
    duration: '3 jours',
    durationDays: 3,
    shortDescription: 'Cours priv√© intensif d√©butant avec h√©bergement',
    fullDescription: 'Formation kitesurf priv√©e intensive de 3 jours avec instructeur d√©di√©. Parfait pour d√©buter en toute confiance avec un accompagnement personnalis√© 100% sur-mesure.',
    included: [
      'H√©bergement 3 jours en maison d\'h√¥tes premium',
      'Cours priv√© exclusif avec instructeur certifi√© IKO',
      'Mat√©riel premium derni√®re g√©n√©ration (aile, planche, harnais)',
      'Transport quotidien vers spots optimaux',
      'Transfert a√©roport aller-retour inclus',
      'Progression acc√©l√©r√©e garantie',
      'Flexibilit√© horaires et spots selon m√©t√©o'
    ],
    stripeProductId: process.env.STRIPE_PRODUCT_BEGINNER_PRIVATE || 'price_1Reo9xHUqGxCezEFwTKoXkzJ',
    stripePriceId: process.env.STRIPE_PRICE_BEGINNER_PRIVATE || 'price_1Reo9xHUqGxCezEFwTKoXkzJ',
    marginNet: 12, // 720‚Ç¨ - 108‚Ç¨ instructeur - 600‚Ç¨ charges
    category: 'private',
    // Legacy compatibility
    description: 'Master kitesurfing with personalized one-on-one instruction in Dakhla\'s perfect lagoon conditions.',
    maxParticipants: 1,
    difficulty: 'beginner',
    image: '/images/dakhla/dakhla-lagoon-1.jpg',
    features: [
      'Private instructor',
      'All equipment included',
      '3 days training',
      'Safety briefing',
      'Progress assessment'
    ]
  },
  
  // üîµ PACKAGES GROUPE (2-4 personnes)
  {
    id: 'semi-private-discovery',
    name: 'Semi-Private Discovery',
    price: 380,
    maxPersons: 4,
    duration: '3 jours',
    durationDays: 3,
    shortDescription: 'D√©couverte kitesurf en petit groupe avec h√©bergement',
    fullDescription: 'Package d√©couverte parfait pour s\'initier au kitesurf en petit groupe convivial. 3 jours d\'apprentissage progressif avec h√©bergement partag√© et libert√© culinaire totale pour d√©couvrir Dakhla.',
    included: [
      'H√©bergement 3 jours partag√© (max 4 personnes)',
      'Cours semi-priv√© progressive (2-4 √©l√®ves par instructeur)',
      'Mat√©riel premium adapt√© niveau d√©butant',
      'Transport quotidien vers spots s√©curis√©s',
      'Transfert a√©roport aller-retour inclus',
      'Ambiance conviviale garantie petit groupe',
      'Libert√© totale restauration (√©conomie 300‚Ç¨ vs concurrence)'
    ],
    stripeProductId: process.env.STRIPE_PRODUCT_DISCOVERY || 'price_NEW_SEMI_PRIVATE_DISCOVERY',
    stripePriceId: process.env.STRIPE_PRICE_DISCOVERY || 'price_NEW_SEMI_PRIVATE_DISCOVERY',
    marginNet: 692, // 1520‚Ç¨ CA (4√ó380) - 228‚Ç¨ instructeur - 600‚Ç¨ charges
    isPopular: true,
    category: 'group',
    // Legacy compatibility
    description: 'Learn kitesurfing with friends in Dakhla\'s crystal-clear lagoon. Perfect balance of personal attention.',
    maxParticipants: 4,
    difficulty: 'beginner',
    image: '/images/dakhla/dakhla-lagoon-2.jpg',
    features: [
      'Small group (max 4 people)',
      'All equipment included',
      '3 days training',
      'Shared learning experience'
    ]
  },

  {
    id: 'semi-private-experience',
    name: 'Semi-Private Experience',
    price: 580,
    maxPersons: 4,
    duration: '5 jours',
    durationDays: 5,
    shortDescription: 'Exp√©rience kitesurf compl√®te en groupe restreint',
    fullDescription: 'S√©jour kitesurf de 5 jours pour progresser efficacement du d√©butant vers l\'autonomie. Format semi-priv√© id√©al pour allier apprentissage de qualit√© et convivialit√© de groupe dans la lagune de Dakhla.',
    included: [
      'H√©bergement 5 jours confort partag√© (max 4 personnes)',
      'Progression cours semi-priv√© structur√©e',
      'Mat√©riel premium vari√© + √©quipement backup',
      'Transport vers spots diversifi√©s selon niveau',
      'Transfert a√©roport aller-retour inclus',
      'Flexibilit√© spots selon conditions m√©t√©o optimales',
      'Sessions th√©oriques s√©curit√© et m√©t√©o',
      'Libert√© culinaire compl√®te Dakhla authentique'
    ],
    stripeProductId: process.env.STRIPE_PRODUCT_EXPERIENCE || 'price_NEW_SEMI_PRIVATE_EXPERIENCE',
    stripePriceId: process.env.STRIPE_PRICE_EXPERIENCE || 'price_NEW_SEMI_PRIVATE_EXPERIENCE',
    marginNet: 972, // 2320‚Ç¨ CA (4√ó580) - 348‚Ç¨ instructeur - 1000‚Ç¨ charges
    category: 'group',
    // Legacy compatibility
    description: '5-day intensive kitesurfing experience in Dakhla\'s best conditions.',
    maxParticipants: 4,
    difficulty: 'intermediate',
    image: '/images/dakhla/white-dune-real.jpg',
    features: [
      'Multiple locations',
      'Transport included',
      '5 days coaching',
      'Spot variety'
    ]
  },

  {
    id: 'semi-private-exploration',
    name: 'Semi-Private Exploration',
    price: 750,
    maxPersons: 4,
    duration: '6 jours',
    durationDays: 6,
    shortDescription: 'Aventure kitesurf avec exploration spots premium',
    fullDescription: 'Package exploration de 6 jours pour d√©couvrir les spots secrets de Dakhla. Parfait √©quilibre entre progression technique encadr√©e et aventure dans les plus beaux spots de la lagune mondiale du kitesurf.',
    included: [
      'H√©bergement 6 jours premium partag√© (max 4 personnes)',
      'Cours semi-priv√© + sessions libres encadr√©es',
      'Exploration spots secrets et premium de Dakhla',
      'Mat√©riel premium derni√®re g√©n√©ration + choix equipment',
      'Transport 4x4 tout-terrain vers spots exclusifs',
      'Transfert a√©roport aller-retour VIP',
      'Briefings m√©t√©o quotidiens professionnels',
      'Sessions photo/vid√©o souvenirs incluses',
      'D√©couverte gastronomie locale en libert√© totale'
    ],
    stripeProductId: process.env.STRIPE_PRODUCT_EXPLORATION || 'price_NEW_EXPLORATION_ADVENTURE',
    stripePriceId: process.env.STRIPE_PRICE_EXPLORATION || 'price_NEW_EXPLORATION_ADVENTURE',
    marginNet: 1350, // 3000‚Ç¨ CA (4√ó750) - 450‚Ç¨ instructeur - 1200‚Ç¨ charges
    isPopular: true,
    category: 'group',
    // Legacy compatibility
    description: 'Explore Dakhla\'s legendary kitesurf spots from White Dune to Dragon Island.',
    maxParticipants: 4,
    difficulty: 'intermediate',
    image: '/images/dakhla/white-dune-real.jpg',
    features: [
      'Multiple locations',
      'Transport included',
      '6 days coaching',
      'Spot variety',
      'Local insights'
    ]
  },

  // ‚≠ê PACKAGE PREMIUM (2-4 personnes)
  {
    id: 'combined-ultimate',
    name: 'Combined Ultimate Experience',
    price: 950,
    maxPersons: 4,
    duration: '7 jours',
    durationDays: 7,
    shortDescription: 'Exp√©rience kitesurf ultime - Formation compl√®te Dakhla',
    fullDescription: 'L\'exp√©rience WindVenture ultime ! 7 jours pour ma√Ætriser le kitesurf dans les meilleures conditions de Dakhla. Formation compl√®te avec exploration approfondie de tous les spots l√©gendaires de la lagune.',
    included: [
      'H√©bergement 7 jours premium confort (max 4 personnes)',
      'Formation compl√®te d√©butant ‚Üí rider autonome',
      'Acc√®s exclusif spots premium et secrets',
      'Mat√©riel haut de gamme vari√© (multiple ailes/planches)',
      'Transport 4x4 confort vers tous types de spots',
      'Transfert a√©roport VIP aller-retour',
      'Coaching personnalis√© quotidien progression',
      'Briefings techniques avanc√©s m√©t√©o/spots',
      'Exploration compl√®te lagune + spots wave',
      'Sessions photo/vid√©o pro incluses',
      'Certificat progression IKO inclus',
      'Libert√© gastronomique totale Dakhla d√©couverte'
    ],
    stripeProductId: process.env.STRIPE_PRODUCT_ULTIMATE || 'price_NEW_COMBINED_ULTIMATE',
    stripePriceId: process.env.STRIPE_PRICE_ULTIMATE || 'price_NEW_COMBINED_ULTIMATE',
    marginNet: 1830, // 3800‚Ç¨ CA (4√ó950) - 570‚Ç¨ instructeur - 1400‚Ç¨ charges
    isPremium: true,
    category: 'premium',
    // Legacy compatibility
    description: 'The ultimate Dakhla kitesurf experience combining technique mastery with exploration.',
    maxParticipants: 4,
    difficulty: 'intermediate',
    isPopular: true,
    image: '/images/dakhla/dragon-island.jpg',
    features: [
      'Best of both worlds',
      '7 days training',
      '3 different spots',
      'Technique & adventure',
      'Complete experience'
    ]
  }
];

// üìä M√âTRIQUES BUSINESS OPTIMIS√âES 4 PERSONNES
export const businessMetrics = {
  // Capacit√© h√©bergement
  maxCapacity: 4,
  
  // Charges fixes quotidiennes (‚Ç¨)
  dailyFixedCosts: {
    accommodation: 63, // Moyenne 500-700 DH/jour = 47-66‚Ç¨
    transport: 142,    // 1500 DH/jour
    total: 205
  },
  
  // Pourcentage instructeur
  instructorPercentage: 0.15,
  
  // Projections CA √† capacit√© max par package
  maxRevenueByPackage: {
    "beginner-private": 720,         // 1 pers √ó 720‚Ç¨
    "semi-private-discovery": 1520,  // 4 pers √ó 380‚Ç¨  
    "semi-private-experience": 2320, // 4 pers √ó 580‚Ç¨
    "exploration-adventure": 3000,   // 4 pers √ó 750‚Ç¨
    "combined-ultimate": 3800        // 4 pers √ó 950‚Ç¨
  },
  
  // Marges nettes √† capacit√© max (‚Ç¨)
  maxMarginByPackage: {
    "beginner-private": 12,
    "semi-private-discovery": 692,
    "semi-private-experience": 972,
    "exploration-adventure": 1350,
    "combined-ultimate": 1830
  },
  
  // Objectifs business valid√©s
  targetsWeekly: {
    conservative: 10,  // clients/semaine ‚Üí 68k‚Ç¨/an net
    optimistic: 15     // clients/semaine ‚Üí 115k‚Ç¨/an net
  },

  // Rentabilit√© par cat√©gorie
  profitabilityByCategory: {
    'private': 12,      // Marge minimale mais premium service
    'group': 1005,      // Moyenne 692+972+1350 / 3
    'premium': 1830     // Marge maximum exp√©rience ultime
  }
};

// üéØ UTILS FONCTIONS BUSINESS
export const packageUtils = {
  // Calculer prix total pour X personnes
  calculateTotalPrice: (packageId: string, persons: number): number => {
    const pkg = packagesOptimized.find(p => p.id === packageId);
    if (!pkg) throw new Error(`Package ${packageId} non trouv√©`);
    
    if (pkg.category === 'private') {
      return pkg.price; // Prix fixe pour package priv√©
    }
    
    const validPersons = Math.min(persons, pkg.maxPersons);
    return pkg.price * validPersons;
  },

  // Calculer marge nette pour X personnes
  calculateNetMargin: (packageId: string, persons: number): number => {
    const pkg = packagesOptimized.find(p => p.id === packageId);
    if (!pkg) return 0;
    
    const totalRevenue = packageUtils.calculateTotalPrice(packageId, persons);
    const instructorCost = totalRevenue * businessMetrics.instructorPercentage;
    const fixedCosts = businessMetrics.dailyFixedCosts.total * pkg.durationDays;
    
    return totalRevenue - instructorCost - fixedCosts;
  },

  // Valider nombre de personnes
  validatePersonCount: (packageId: string, persons: number): boolean => {
    const pkg = packagesOptimized.find(p => p.id === packageId);
    if (!pkg) return false;
    
    return persons >= 1 && persons <= pkg.maxPersons;
  },

  // Obtenir packages populaires
  getPopularPackages: () => {
    return packagesOptimized.filter(pkg => pkg.isPopular);
  },

  // Obtenir packages par cat√©gorie
  getPackagesByCategory: (category: Package['category']) => {
    return packagesOptimized.filter(pkg => pkg.category === category);
  }
};

// üéØ STRAT√âGIE PRICING DIFF√âRENCI√âE
export const pricingStrategy = {
  positioning: "Premium sans restauration - Libert√© culinaire",
  competitive_advantage: "300‚Ç¨ √©conomies vs concurrence pension compl√®te",
  target_market: "Client√®le internationale premium 25-45 ans",
  seasonality: "Octobre √† Mai (6-8 mois activit√© optimale)",
  
  // Messages marketing cl√©s
  marketing_messages: [
    "H√©bergement + Kitesurf + Libert√© culinaire totale",
    "Explorez la gastronomie authentique de Dakhla", 
    "Prix transparent par personne, sans pension impos√©e",
    "Capacit√© limit√©e 4 personnes = exp√©rience premium exclusive",
    "√âconomisez 300‚Ç¨ vs packages pension compl√®te traditionnels"
  ],

  // USPs uniques
  unique_selling_points: [
    "Seule √©cole Dakhla avec pricing transparent par personne",
    "Maximum 4 personnes = ratio instructeur optimal",
    "H√©bergement partag√© convivial premium",
    "Libert√© culinaire d√©couverte Dakhla authentique",
    "Progression garantie ou remboursement"
  ]
};

// Legacy compatibility - keeping old function name
export const calculatePackageTotal = (packageId: string, participants: number): number => {
  return packageUtils.calculateTotalPrice(packageId, participants);
};

// ‚úÖ STANDARDIZED EXPORTS FOR CONSISTENCY
export const optimizedPackages = packagesOptimized;
export const packages = packagesOptimized; // Alias for legacy compatibility
export const PACKAGES_DATA = packagesOptimized; // Alias for components expecting this name

export default optimizedPackages;